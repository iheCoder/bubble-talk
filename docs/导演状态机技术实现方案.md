# å¯¼æ¼”çŠ¶æ€æœºæŠ€æœ¯å®ç°æ–¹æ¡ˆ



## 1. æ€»ä½“æ¶æ„ï¼šæŠŠâ€œå­¦ä¹ å¯¹è¯â€åšæˆä¸€å°äº‹ä»¶é©±åŠ¨çš„ç”µå½±å‰ªè¾‘æœº

æ ¸å¿ƒæ€è·¯ï¼š**å¯¼æ¼”ä¸ç›´æ¥â€œèŠå¤©â€ï¼Œå¯¼æ¼”åªåšâ€œè°ƒåº¦å†³ç­–â€**ã€‚å®é™…å°è¯ç”±â€œæ¼”å‘˜æ¨¡å‹â€ç”Ÿæˆã€‚è¿™æ ·å¯¹è¯æ‰ç¨³å®šã€å¯æ§ã€å¯æ‰©å±•ã€‚

#### 1.1 å…³é”®ç»„ä»¶

- **Session Orchestratorï¼ˆä¼šè¯ç¼–æ’å™¨ï¼‰**ï¼šäº‹ä»¶å¾ªç¯ï¼Œç»´æŠ¤ session çŠ¶æ€ï¼Œè°ƒç”¨å¯¼æ¼”ã€æ¼”å‘˜ã€é¢˜ç›®ç”Ÿæˆå™¨ã€‚
- **Director Engineï¼ˆå¯¼æ¼”å¼•æ“ï¼‰**ï¼šè¾“å…¥çŠ¶æ€ + ç”¨æˆ·è¯è¯­ â†’ è¾“å‡º `DirectorPlan`ï¼ˆä¸‹ä¸€æ‹ç‚¹ã€è§’è‰²ã€è¾“å‡ºåŠ¨ä½œã€èŠ‚å¥ã€æ ˆæ“ä½œï¼‰ã€‚
- **Actor Engineï¼ˆæ¼”å‘˜å¼•æ“ï¼‰**ï¼šæŒ‰ `DirectorPlan` + Beat æŒ‡ä»¤å¡ç”Ÿæˆä¸‹ä¸€æ®µå°è¯ï¼ˆæ–‡æœ¬/è¯­éŸ³è„šæœ¬ï¼‰ã€‚
- **Assessment Engineï¼ˆæµ‹è¯„å¼•æ“ï¼‰**ï¼šè‡ªé€‚åº”æµ‹è¯„ã€æ‹ç‚¹ä¸­çš„å¿«é¢˜ã€ExitTicketã€‚
- **Knowledge/Asset Layerï¼ˆçŸ¥è¯†ä¸ç´ æå±‚ï¼‰**ï¼šæ¦‚å¿µå›¾è°±ã€æƒ…å¢ƒæ¨¡æ¿ã€è¯¯è§£æ ‡ç­¾ã€æ•…äº‹/æ¼«ç”»/å›¾è§£ç´ æã€‚
- **Memory Layerï¼ˆè®°å¿†å±‚ï¼‰**ï¼šä¼šè¯çŸ­æœŸè®°å¿† + ç”¨æˆ·é•¿æœŸå­¦ä¹ ç”»åƒ + å¤–éƒ¨èµ„æ–™ï¼ˆå¯é€‰ï¼‰ã€‚
- **Realtime Voice I/Oï¼ˆå®æ—¶è¯­éŸ³äº¤äº’ï¼‰**ï¼šASR æµå¼è¯†åˆ« + TTS æµå¼æ’­æ”¾ + æ’è¯ä¸­æ–­ï¼ˆbarge-inï¼‰ã€‚



## 2. æ ¸å¿ƒå¯¹è±¡ä¸æ•°æ®ç»“æ„ï¼šä¸€åˆ‡éƒ½ç»“æ„åŒ–ï¼Œå¯¼æ¼”åªâ€œå¡«è¡¨â€

### 2.1 Bubble / Entryï¼ˆæ³¡æ³¡å…¥å£ï¼‰

> æ³¡æ³¡ä¸æ˜¯â€œæ¦‚å¿µåâ€ï¼Œæ˜¯â€œæƒ…å¢ƒå…¥å£â€ï¼Œä½†å¿…é¡»èƒ½æ˜ å°„åˆ°æ¦‚å¿µéª¨æ¶ã€‚

```json
{
  "entry_id": "econ_offer_weekend_worthit",
  "domain": "economics",
  "title": "å‘¨æœ«åŠ ç­å€¼ä¸å€¼ï¼Ÿ",
  "hook": "ä½ ä»¥ä¸ºèµšäº†800ï¼Œå…¶å®å¯èƒ½äºäº†æ›´è´µçš„ä¸œè¥¿ã€‚",
  "primary_concept_id": "econ_opportunity_cost",
  "secondary_concepts": ["econ_time_preference"],
  "scenario_id": "scn_weekend_tradeoff",
  "difficulty_hint": 2
}
```

### 2.2 Concept Packï¼ˆæ¦‚å¿µè¯¾åŒ…éª¨æ¶ï¼‰

å¯¼æ¼”ä¸é¢˜ç›®ç”Ÿæˆå¿…é¡»ä¾èµ–å®ƒï¼Œé¿å…â€œéšå£èƒ¡è¯´â€ã€‚

```json
{
  "concept_id": "econ_opportunity_cost",
  "core_relation": "æœºä¼šæˆæœ¬=æ”¾å¼ƒçš„æœ€å¥½æ›¿ä»£é€‰æ‹©çš„ä»·å€¼ï¼ˆä¸æ˜¯æ”¯å‡ºæœ¬èº«ï¼‰",
  "misconceptions": [
    {"tag": "M1_cost_equals_money_spent", "splitter_prompt": "æŠŠæœºä¼šæˆæœ¬è¯¯è®¤ä¸ºèŠ±å‡ºå»çš„é’±"},
    {"tag": "M2_sunk_cost_confusion", "splitter_prompt": "æ··æ·†æ²‰æ²¡æˆæœ¬ä¸æœºä¼šæˆæœ¬"}
  ],
  "boundaries": ["å½“æ›¿ä»£é€‰æ‹©ä¸æ˜ç¡®æ—¶ï¼Œç”¨'æœ€å¥½æ›¿ä»£'å®šä¹‰ä¼šå˜æ¨¡ç³Šï¼Œéœ€è¦è¡¥å……å‡è®¾"],
  "story_assets": ["asset_story_offer", "asset_story_queue"],
  "transfer_targets": ["product_scope_tradeoff", "policy_budget_tradeoff"]
}
```

### 2.3 SessionStateï¼ˆä¼šè¯çŠ¶æ€ï¼‰

è¿™æ˜¯å¯¼æ¼”å¼•æ“çš„â€œè¾“å…¥ç”»æ¿â€ã€‚

```json
{
  "session_id": "...",
  "entry_id": "...",
  "main_objective": "ç”¨æœºä¼šæˆæœ¬çš„é•œå¤´è§£é‡Šå–èˆï¼Œå¹¶èƒ½åŒºåˆ†å®ƒä¸æ”¯å‡º/æ²‰æ²¡æˆæœ¬",
  "act": 2,
  "stage": "SEMINAR",
  "beat": "TwistBeat",
  "mastery_estimate": 0.42,
  "misconception_tags": ["M1_cost_equals_money_spent"],
  "output_clock_sec": 83,
  "tension_level": 3,
  "cognitive_load": 2,
  "pacing_mode": "NORMAL",
  "question_stack": [
    {"q": "é‚£æ˜¯ä¸æ˜¯æ‰€æœ‰é€‰æ‹©éƒ½èƒ½ç®—å‡ºæœºä¼šæˆæœ¬ï¼Ÿ", "urgency": 2, "at_beat": "RevealBeat"}
  ],
  "signals": {
    "turns": 9,
    "avg_latency_ms": 950,
    "interruptions": 2,
    "user_output_quality": 0.55,
    "affect_proxy": {"confusion": 0.6, "boredom": 0.1, "frustration": 0.2}
  }
}
```

### 2.4 DirectorPlanï¼ˆå¯¼æ¼”å†³ç­–è¾“å‡ºï¼‰

å¯¼æ¼”å¼•æ“åªäº§å‡ºè¿™ä¸ªï¼Œç¡®ä¿ç³»ç»Ÿå¯æ§ã€‚

```json
{
  "user_mind_state": ["Partial", "Verify"],
  "flow_mode": "RESCUE",
  "intent": "Deepen",
  "next_beat": "LensShiftBeat",
  "next_role": "economist",
  "output_action": "OneSentenceRecap",
  "talk_burst_limit_sec": 35,
  "tension_goal": "maintain",
  "load_goal": "maintain",
  "stack_action": "keep",
  "notes": "æ¢è§†è§’è§£é‡Šï¼Œç¨³å®šæ ¸å¿ƒå…³ç³»ï¼Œå¹¶ç«‹åˆ»è®©ç”¨æˆ·å¤è¿°æ ¡å‡†",
  "debug": {
    "beat_candidates": ["LensShiftBeat", "CheckBeat", "TwistBeat"],
    "beat_choice_reason": "ç”¨æˆ·èƒ½è¯´å‡ºç‚¹é€»è¾‘ä½†è¾¹ç•Œæ··ä¹±ï¼Œä¼˜å…ˆæ¢é•œå¤´ï¼›ä¸” output_clock æœªåˆ°ç¡¬é˜ˆå€¼"
  }
}
```

------

## 3. æ‰§è¡Œå¾ªç¯ï¼šäº‹ä»¶é©±åŠ¨çš„â€œå¯¼æ¼”-æ¼”å‘˜-è§‚ä¼—â€å›åˆåˆ¶

### 3.1 é«˜å±‚äº‹ä»¶æµ

1. ç”¨æˆ·ç‚¹å‡»æ³¡æ³¡ â†’ `ENTER`
2. `DIAGNOSE`ï¼šæµ‹è¯„å¼•æ“å‡º 2â€“4 é¢˜ â†’ æ›´æ–° `mastery_estimate/misconceptions`
3. `SEMINAR`ï¼šå¾ªç¯æ‰§è¡Œæ‹ç‚¹
4. ç”¨æˆ·è¯·æ±‚ç»“æŸ or è¾¾åˆ°æ”¶æŸæ¡ä»¶ â†’ `EXIT`ï¼šExitTicket
5. å†™å›ç”¨æˆ·æ¨¡å‹ â†’ `UPDATE` â†’ å›é¦–é¡µæ³¡æ³¡æ›´æ–°

### 3.2 Seminar å›åˆï¼ˆå…³é”®ï¼‰

æ¯å›åˆå¤„ç†ä¸€ä¸ªâ€œæ‹ç‚¹â€ï¼š

- æ”¶é›†è¾“å…¥ï¼š`UserUtterance + LastTurnsSummary + SessionState`
- è°ƒç”¨å¯¼æ¼”ï¼š`DirectorEngine(...) -> DirectorPlan`
- æ ¹æ® DirectorPlan é€‰æ‹© Beat æŒ‡ä»¤å¡ï¼Œæ„é€ ç»™æ¼”å‘˜çš„â€œå°è¯ä»»åŠ¡ä¹¦â€
- è°ƒç”¨æ¼”å‘˜ç”Ÿæˆå°è¯ï¼ˆæ–‡æœ¬/è¯­éŸ³è„šæœ¬ï¼‰
- æ’­æ”¾ï¼ˆTTSï¼‰æˆ–å±•ç¤ºæ–‡æœ¬
- ç­‰å¾…ç”¨æˆ·æ’è¯ï¼ˆå« barge-inï¼‰å¹¶è®°å½•ä¿¡å·
- æ›´æ–°çŠ¶æ€ï¼šOutputClockã€MindStateã€æ ˆã€è¯¯è§£æ ‡ç­¾ã€æŒæ¡åº¦

------

## 4. å¯¼æ¼”å¼•æ“å®ç°ï¼šè§„åˆ™ç¡¬çº¦æŸ + LLM è½¯å†³ç­–çš„æ··åˆç­–ç•¥

å¯¼æ¼”ä¸èƒ½çº¯ LLMï¼ˆå¤ªæ¼‚ï¼‰ï¼Œä¹Ÿä¸èƒ½çº¯è§„åˆ™ï¼ˆå¤ªæ­»ï¼‰ã€‚æ¨è **Hybrid Policy**ï¼š

### 4.1 ä¸‰å±‚å†³ç­–æ¡†æ¶

#### Layer Aï¼šç¡¬çº¦æŸæ ¡éªŒï¼ˆDeterministic Guardrailsï¼‰

åœ¨è°ƒç”¨ LLM æˆ–æ¥å—å…¶è¾“å‡ºå‰ï¼Œå…ˆåšç¡¬çº¦æŸï¼š

- `output_clock_sec >= 90` â†’ next_beat å¿…é¡» âˆˆ {CheckBeat, FeynmanBeat, MiniGameBeat, TransferSwap, ExitTicket}
- ç”¨æˆ·è¯´â€œæ‡‚äº†/ç»“æŸâ€ â†’ next_beat å¿…é¡»æ˜¯ ExitTicket æˆ– Transfer æ£€éªŒ
- Branch â†’ é»˜è®¤å…¥æ ˆ + BranchTeaserBeatï¼ˆé™¤éä¸å½“å‰è¯¯è§£å¼ºç›¸å…³ï¼Œæ‰å¯é™ä¸º Deepenï¼‰
- `next_role` å¿…é¡» âˆˆ `state.available_roles`ï¼ˆæ³¡æ³¡è§’è‰²é›†åˆå›ºå®šï¼Œå¯¼æ¼”ä¸èƒ½â€œå‘æ˜æ–°è§’è‰²â€ï¼‰
- `next_beat` å¿…é¡» âˆˆ BeatLibraryï¼ˆä¸å…è®¸è¾“å‡ºæœªçŸ¥æ‹ç‚¹ï¼›æœªçŸ¥åˆ™å›é€€åˆ° CheckBeatï¼‰
- `output_action` å¿…é¡»èƒ½è½åˆ°â€œå¯è§‚æµ‹ç”¨æˆ·è¾“å‡ºâ€ï¼ˆå¤è¿°/é€‰æ‹©/ä¸¾ä¾‹/è¾¹ç•Œ/è¿ç§»ï¼‰ï¼Œå¦åˆ™è§†ä¸ºæ— æ•ˆè®¡åˆ’

#### Layer Bï¼šæ„å›¾/å¿ƒæ™ºçŠ¶æ€è¯†åˆ«ï¼ˆLLM + Heuristicï¼‰

- **Heuristic** å…ˆç²—åˆ¤ï¼šå…³é”®è¯ã€æ˜¯å¦é—® why/howã€æ˜¯å¦ææ–°æ¦‚å¿µåã€æ˜¯å¦è¯·æ±‚æ¢é£æ ¼ã€æ˜¯å¦å¤§é‡â€œå—¯/æ‡‚äº†â€
- **LLM Router** ç²¾åˆ¤è¾“å‡ºï¼š`UserMindState` + `Intent` + `Confidence`
- æœ€ç»ˆç”¨åŠ æƒèåˆï¼šheuristic å…œåº•ï¼ŒLLM è´Ÿè´£ç»†è…»åˆ¤æ–­

#### Layer Cï¼šæ‹ç‚¹é€‰æ‹©ï¼ˆBeat Strategy Mappingï¼‰

ä¸å†ä½¿ç”¨å¤æ‚çš„â€œå€™é€‰é›†+æ‰“åˆ†â€ï¼Œè€Œæ˜¯å…ˆåŸºäº **UserMindStateï¼ˆç”¨æˆ·å¿ƒç†çŠ¶æ€ï¼‰** ç”Ÿæˆä¸€ä¸ªâ€œåˆç†å€™é€‰é›†â€ï¼Œå†ç”± LLM åœ¨å€™é€‰é›†ä¸­åšâ€œåƒäººç±»å¯¼æ¼”ä¸€æ ·çš„æ‹ç‚¹é€‰æ‹©â€ã€‚

æ­¤å¤–æ–°å¢ä¸€ä¸ªä¸å±äº 7 ç§å¿ƒæ™ºçŠ¶æ€çš„â€œé¡ºæµæ¨¡å¼â€ï¼š
- **é¡ºæµï¼ˆFlowï¼‰**ï¼šç”¨æˆ·ç†è§£æ¨è¿›é¡ºç•…ã€äº’åŠ¨ç¨³å®šã€æ— éœ€æ•‘åœºï¼›å¯¼æ¼”ä»¥â€œç»´æŒèŠ‚å¥ + å¾®æ ¡å‡†â€ä¸ºä¸»ã€‚

> ç›´è§‰ï¼š7 ç§çŠ¶æ€ä¸»è¦æ˜¯â€œéœ€è¦å¯¼æ¼”æ•‘åœºæ—¶ä½ çœ‹è§çš„æˆâ€ï¼Œè€Œ Flow æ˜¯â€œæˆæ‹å¾—å¾ˆé¡ºâ€çš„é•œå¤´è¯­è¨€å¼€å…³ã€‚

| ç”¨æˆ·å¿ƒç†çŠ¶æ€ (UserMindState) | çŠ¶æ€ç‰¹å¾ (Signals) | å¯¼æ¼”çš„â€œæ•‘åœºâ€ç­–ç•¥ (Beat Strategy) | æ‰§è¡ŒåŠ¨ä½œ |
| :--- | :--- | :--- | :--- |
| **1. è¿·é›¾ (Fog) ğŸŒ«ï¸** | é€»è¾‘å‘æ•£ï¼Œåå¤é—®â€œåˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿâ€ï¼Œè¡¨ç°ç„¦è™‘ã€‚ | **RevealBeat** | ä¸“å®¶é—­å˜´ï¼Œæ¢åŒä¼´ç”¨æœ€é€šä¿—çš„æ¯”å–»é‡æ„æ¨¡å‹ï¼ˆé™ç»´æ‰“å‡»ï¼‰ã€‚ |
| **2. é”™è§‰ (Illusion) ğŸ¤¡** | è§‰å¾—è‡ªå·±æ‡‚äº†ï¼Œä½†å¤è¿°ç©ºæ´ï¼Œåªæœ‰â€œå—¯/æ‡‚äº†â€ã€‚ | **TwistBeat / CheckBeat** | ç›´æ¥æ‰”ä¸ªâ€œæ‰“è„¸é¢˜â€æˆ–åä¾‹ï¼Œæˆ³ç ´æ³¡æ²«ã€‚ |
| **3. åŠæ‡‚ (Partial) ğŸŒ“** | èƒ½è¯´å‡ºç‚¹é€»è¾‘ï¼Œä½†ä¸€ç¢°è¾¹ç•Œå°±ä¹±ã€‚ | **LensShiftBeat** | æ¢ä¸ªé•œå¤´è§†è§’é‡æ–°è§£é‡Šï¼Œç›´åˆ°è¾¹ç•Œæ¸…æ™°ã€‚ |
| **4. é¡¿æ‚Ÿ (Aha!) ğŸ’¡** | æŠ“ä½æ ¸å¿ƒå…³ç³»ï¼Œè§£é‡Šå˜æ¸…æ™°ï¼Œè¯­è°ƒå˜å…´å¥‹ã€‚ | **FeynmanBeat** | è¶çƒ­æ‰“é“ï¼Œè®©ä½ ç»“æ„åŒ–åœ°è®²ç»™â€œç¬¨è›‹åŒä¼´â€å¬ã€‚ |
| **5. æ±‚è¯ (Verify) ğŸ”** | å¼€å§‹ä¸»åŠ¨é—®åä¾‹ã€é€‚ç”¨æ¡ä»¶å’Œä¸¥è°¨å®šä¹‰ã€‚ | **Deepen** | å¼•å…¥æŒ‘æˆ˜è€…è§’è‰²ï¼Œç»™æ›´æ·±å±‚çš„æœºåˆ¶é“¾ã€‚ |
| **6. å¤–æ‰© (Expand) ğŸš€** | ä¸»åŠ¨è”æƒ³åˆ°ç°å®æ¡ˆä¾‹æˆ–å…¶ä»–é¢†åŸŸã€‚ | **MontageBeat** | å¼€å¯â€œè¿ç§»è’™å¤ªå¥‡â€ï¼Œåœ¨ä¸åŒåœºæ™¯ä¸­å¿«é€Ÿåˆ‡æ¢ã€‚ |
| **7. ç–²æƒ« (Fatigue) ğŸ¥±** | è¾“å‡ºå˜çŸ­ï¼ˆå¦‚â€œå“¦â€ã€â€œè¡Œâ€ï¼‰ï¼Œå“åº”å»¶è¿Ÿå˜é•¿ã€‚ | **MiniGameBeat / Cooldown** | ç«‹åˆ»åœè¯¾ç©æ¸¸æˆï¼Œæˆ–å¯åŠ¨ CooldownBeat å¼ºè¡Œæ”¶å°¾ã€‚ |
| **ï¼ˆæ¨¡å¼ï¼‰é¡ºæµ (Flow) ğŸŒŠ** | ç”¨æˆ·è¾“å‡ºè´¨é‡ç¨³å®šã€æ— æ˜æ˜¾è¯¯è§£ã€èŠ‚å¥èˆ’æœã€‚ | **ContinueBeat / MicroCheck** | ä¿æŒå½“å‰å™äº‹æƒ¯æ€§ï¼Œå°æ­¥æ¨è¿› + å°æ­¥æ ¡å‡†ï¼Œé¿å…â€œæ‰“æ–­é¡ºæµâ€ã€‚ |

### 4.2 è¯„åˆ†ç‰¹å¾ï¼ˆå·²åºŸå¼ƒï¼‰

*åŸæœ‰çš„å¤æ‚æ‰“åˆ†é€»è¾‘ï¼ˆgain/curve/fitï¼‰å·²ç®€åŒ–ä¸ºä¸Šè¿°ç›´æ¥æ˜ å°„è¡¨ã€‚*

### 4.3 å‡çº§ç‚¹ï¼šåŸºäº LLM çš„â€œæ‹ç‚¹é€‰æ‹©â€ï¼ˆBeat Pickerï¼‰

ç°çŠ¶ï¼ˆä»£ç ï¼‰é‡Œæ‹ç‚¹é€‰æ‹©åè§„åˆ™/éšæœºï¼›å‡çº§ç›®æ ‡æ˜¯è®©å¯¼æ¼”èƒ½â€œåƒäººä¸€æ ·â€é€‰æ‹©ä¸‹ä¸€ä¸ªé•œå¤´ï¼Œè€Œä¸æ˜¯æŒ‰å›ºå®šè¡¨è½®è½¬ã€‚

#### 4.3.1 å…³é”®çº¦æŸï¼šLLM åªèƒ½åœ¨ BeatLibrary å†…åšé€‰æ‹©

BeatLibrary æ˜¯ä¸€ç»„ç»“æ„åŒ–æ‹ç‚¹å¡ï¼ˆå¯å‚è€ƒ `docs/é™„ä»¶ Aï¼šå¯¼æ¼”çŠ¶æ€æœºè§„åˆ™é›†ï¼ˆDirector State Machine Rule Setï¼‰.md` çš„ Beat ç±»å‹åº“ï¼‰ã€‚æ¯å¼ å¡è‡³å°‘åŒ…å«ï¼š
- `beat_id`ï¼šå”¯ä¸€æ ‡è¯†ï¼ˆå¦‚ RevealBeat/CheckBeat/...ï¼‰
- `goal`ï¼šè¿™ä¸€æ‹ç‚¹è¦è¾¾æˆçš„æ•™å­¦ç›®æ ‡
- `user_must_do`ï¼šå¿…é¡»é€¼å‡ºç”¨æˆ·è¾“å‡ºçš„å½¢å¼ï¼ˆå¤è¿°/é€‰æ‹©/ä¸¾ä¾‹/è¾¹ç•Œ/è¿ç§»ï¼‰
- `talk_burst_limit_sec_hint`ï¼šé»˜è®¤æ—¶é•¿ä¸Šé™å»ºè®®
- `exit_condition`ï¼šä»€ä¹ˆæ—¶å€™ç®—å®Œæˆ
- `next_suggest`ï¼šå®Œæˆåå¸¸è§çš„ä¸‹ä¸€æ‹ç‚¹å€™é€‰

å¯¼æ¼” LLM çš„è¾“å…¥é‡Œåªå…è®¸å‡ºç°è¿™äº› beat å¡ï¼ˆæˆ–å…¶æ‘˜è¦ï¼‰ï¼Œä»æºå¤´é™ä½èƒ¡é€‰æ‹ç‚¹çš„æ¦‚ç‡ã€‚

#### 4.3.2 å€™é€‰é›†ç”Ÿæˆï¼šç”¨è§„åˆ™æŠŠæœç´¢ç©ºé—´ç¼©å°åˆ°â€œåˆç†â€

æ¨èæŠŠ Layer C æ‹†æˆä¸¤æ­¥ï¼š
1) **CandidateBuilderï¼ˆè§„åˆ™ï¼‰**ï¼šæ ¹æ®ç¡¬çº¦æŸ + MindState + FlowMode äº§å‡º `beat_candidates`ï¼ˆé€šå¸¸ 3â€“6 ä¸ªï¼‰
2) **BeatPickerï¼ˆLLMï¼‰**ï¼šä»å€™é€‰é›†ä¸­é€‰ `next_beat`ï¼Œå¹¶å†™å‡ºâ€œå¯æ‰§è¡Œç†ç”±â€ï¼ˆç”¨äº debugï¼Œè€Œä¸æ˜¯ç»™ç”¨æˆ·ï¼‰

CandidateBuilder çš„å…¸å‹è§„åˆ™ï¼š
- `output_clock_sec >= 90`ï¼šå€™é€‰å¼ºåˆ¶åŒ…å« Check/Feynman/ExitTicketï¼ˆé€¼è¾“å‡ºï¼‰
- `FlowMode == FLOW`ï¼šå€™é€‰ä¼˜å…ˆ Continue/MicroCheck/Deepenï¼ˆå°æ­¥æ¨è¿›ï¼‰ï¼Œé¿å…çªç„¶ Twist/Cooldown æ‰“æ–­ä½“éªŒ
- `Illusion` é«˜ï¼šå€™é€‰ä¼˜å…ˆ Twist/Checkï¼ˆä¸è¦ç»§ç»­è®²ï¼‰
- `Fatigue` é«˜ï¼šå€™é€‰ä¼˜å…ˆ MiniGame/Cooldown/ExitTicketï¼ˆé™è´Ÿè·ï¼‰
- `Branch` å…¥æ ˆï¼šå€™é€‰åŒ…å« BranchTeaser æˆ– MiniLoopï¼ˆçŸ­ Revealâ†’Checkâ†’Cooldownï¼‰

#### 4.3.3 BeatPicker çš„ LLM è¾“å‡ºï¼ˆç»“æ„åŒ– JSONï¼‰

å»ºè®®è®©å¯¼æ¼” LLM ç›´æ¥è¾“å‡º `DirectorPlan` çš„å­é›†ï¼Œå¹¶å¼ºåˆ¶ JSONï¼ˆä¾¿äºæ ¡éªŒä¸å›æ”¾ï¼‰ï¼š
- `next_beat`
- `intent`
- `output_action`
- `talk_burst_limit_sec`
- `notes`ï¼ˆçŸ­å¥ï¼Œå†™ç»™å·¥ç¨‹è°ƒè¯•ï¼‰
- `debug.beat_choice_reason`ï¼ˆå¯é€‰ï¼‰

åŒæ—¶åŠ å…¥â€œé¡ºæµâ€å­—æ®µï¼ˆä¸å±äº 7 å¿ƒæ™ºçŠ¶æ€ï¼‰ï¼š
- `flow_mode: FLOW|RESCUE`

#### 4.3.4 æ›´è¿½æ±‚æ•ˆæœçš„åšæ³•ï¼šåŒé˜¶æ®µ LLMï¼ˆPlanner â†’ Criticï¼‰

å¦‚æœä½ ä¸åœ¨ä¹æ…¢/è´µï¼Œæ•ˆæœä¼˜å…ˆï¼Œæ¨èç”¨â€œåŒé˜¶æ®µå¯¼æ¼”â€ï¼š
- **Planner**ï¼šç”Ÿæˆ 3 ä¸ªå€™é€‰ `DirectorPlan`ï¼ˆä¸åŒæ‹ç‚¹/ä¸åŒå™äº‹ç­–ç•¥ï¼‰ï¼Œæ¯ä¸ªéƒ½æ˜ç¡® `user_must_do`
- **Critic/Judge**ï¼šå¯¹ 3 ä¸ªå€™é€‰åšä¸€è‡´æ€§æ£€æŸ¥ä¸æ”¶ç›Šè¯„ä¼°ï¼ˆç›®æ ‡æ¨è¿›/æƒ…ç»ªæ›²çº¿/èŠ‚å¥/æŠ¤æ ï¼‰ï¼Œé€‰æœ€ä¼˜

è¿™ä¸€æ­¥å¯¹â€œåƒäººä¸€æ ·é€‰é•œå¤´â€çš„æå‡éå¸¸æ˜æ˜¾ï¼šå®ƒæŠŠâ€œæ‹ç‚¹é€‰æ‹©â€ä»ä¸€æ¬¡æ€§çŒœæµ‹å˜æˆå°è§„æ¨¡æœç´¢ã€‚

#### 4.3.5 BeatPicker çš„ Prompt å½¢æ€ï¼ˆå»ºè®®ï¼‰

å»ºè®®æŠŠâ€œå¯¼æ¼” LLMâ€å½“æˆä¸€ä¸ªä¸¥æ ¼çš„ç»“æ„åŒ–å†³ç­–å™¨ï¼š**ä¸å†™å°è¯ï¼Œåªé€‰æ‹ç‚¹å¹¶å†™æ¸…â€œç”¨æˆ·å¿…é¡»è¾“å‡ºä»€ä¹ˆâ€**ã€‚

è¾“å…¥ï¼ˆç¤ºæ„ï¼‰ï¼š
- `DirectorInput`ï¼ˆç»“æ„åŒ–é¢æ¿ï¼šmastery/misconceptions/output_clock/tension/load/summaryï¼‰
- `available_roles`ï¼ˆç”¨äºåç»­é€‰è§’ï¼Œå¯å…ˆé™„å¸¦ï¼‰
- `beat_candidates`ï¼ˆæ¯ä¸ªå€™é€‰ç»™ 1 è¡Œ goal + user_must_doï¼‰
- `guardrails`ï¼ˆç¡¬çº¦æŸæ‘˜è¦ï¼‰

è¾“å‡ºï¼ˆå»ºè®® JSON Schemaï¼Œä¾¿äºæ ¡éªŒ/å›æ”¾ï¼‰ï¼š
```json
{
  "flow_mode": "FLOW|RESCUE",
  "user_mind_state": ["Fog|Illusion|Partial|Aha|Verify|Expand|Fatigue"],
  "intent": "Clarify|Deepen|Branch|Meta|OffTopic|Continue",
  "next_beat": "BeatID",
  "output_action": "ActionID",
  "user_must_do": {
    "type": "teach_back|choice|example|boundary|transfer",
    "prompt": "ç»™ç”¨æˆ·çš„é‚£å¥è¯è¦æ±‚ï¼ˆå¿…é¡»å¯æ‰§è¡Œï¼‰"
  },
  "talk_burst_limit_sec": 15,
  "notes": "ç»™å·¥ç¨‹è°ƒè¯•çš„ 1 å¥è¯",
  "debug": {
    "beat_candidates": ["..."],
    "beat_choice_reason": "..."
  }
}
```

> `ContinueBeat/MicroCheck` çš„å»ºè®®ï¼šä¸è¦å¼ºè¡Œæ–°å¢å¤ªå¤šâ€œæ–° Beat åå­—â€ã€‚å¯ä»¥æŠŠ ContinueBeat ä½œä¸º `continue`ï¼ˆæ—¢æœ‰ beatï¼‰çš„è¯­ä¹‰å‡çº§ï¼›MicroCheck åˆ™æ˜¯ CheckBeat çš„â€œçŸ­ç‰ˆé…ç½®â€ï¼ˆæ›´çŸ­ talk_burst + æ›´è½»è¾“å‡ºè¦æ±‚ï¼‰ã€‚

### 4.4 å‡çº§ç‚¹ï¼šBeat ç¡®å®šåï¼ŒåŸºäº LLM çš„â€œé€‰è§’â€ï¼ˆRole Pickerï¼‰

ä½ è¦çš„é¡ºåºæ˜¯ï¼šå…ˆé€‰ beat â†’ å†åœ¨æ³¡æ³¡è§’è‰²ä¸­é€‰æœ€é€‚åˆçš„è§’è‰²ã€‚è¿™ä¸ªé¡ºåºå¾ˆåˆç†ï¼Œå› ä¸ºè§’è‰²æœ¬è´¨æ˜¯â€œé•œå¤´è¯­è¨€è½½ä½“â€ã€‚

#### 4.4.1 è¾“å…¥ï¼šæ³¡æ³¡è§’è‰²é›†åˆ + è§’è‰²èƒ½åŠ›çŸ©é˜µ

å¯¼æ¼”å¿…é¡»åœ¨ `state.available_roles` å†…é€‰è§’ï¼ˆæ³¡æ³¡å›ºå®šè§’è‰²ï¼‰ï¼Œå¹¶ç»“åˆè§’è‰²èƒ½åŠ›è¾¹ç•Œï¼ˆå»ºè®®å‚è€ƒ `docs/å¯¼æ¼”å¦‚ä½•è°ƒåº¦â€œæ³¡æ³¡è§’è‰²â€.md` çš„ `allowed_actions/allowed_stances` æ€è·¯ï¼‰ã€‚

RolePicker çš„è¾“å…¥å»ºè®®åŒ…å«ï¼š
- `available_roles`ï¼šå¦‚ `["host","economist"]`
- `role_capabilities`ï¼šæ¯ä¸ª role çš„ persona + allowed_actions + allowed_stances + å·¥å…·åå¥½
- `recent_role_memory`ï¼šæœ€è¿‘ 2â€“3 è½®ç”±è°è¯´ã€åšäº†ä»€ä¹ˆï¼ˆé¿å…æ¥å›åˆ‡äººæˆ–ä¸€äººç‹¬ç™½ï¼‰
- `next_beat` ä¸ `user_mind_state` ä¸ `flow_mode`

#### 4.4.2 é€‰æ‹©è§„åˆ™ï¼šå¯è§£é‡Šï¼Œä½†ä¸éœ€è¦â€œåƒµç¡¬â€

å…ˆè§„åˆ™è¿‡æ»¤ï¼ˆç¡¬çº¦æŸï¼‰ï¼Œå† LLM ç»†é€‰ï¼ˆè½¯åå¥½ï¼‰ï¼š
- è¿‡æ»¤ï¼šä¸å…è®¸çš„ action/stance ç›´æ¥å‰”é™¤
- åå¥½ï¼šä¸¥è°¨çº é”™â†’åâ€œä¸“å®¶å‹è§’è‰²â€ï¼ŒèŠ‚å¥å¼•å¯¼ä¸é€¼è¾“å‡ºâ†’åâ€œä¸»æŒäººå‹è§’è‰²â€
- é¡ºæµï¼šä¼˜å…ˆä¿æŒä¸Šä¸€ä½è¯´è¯è§’è‰²ï¼ˆé™ä½â€œé•œå¤´è·³åˆ‡â€çš„å‰²è£‚æ„Ÿï¼‰ï¼Œé™¤éæœ‰å¼ºç†ç”±åˆ‡äºº

è¾“å‡ºï¼š
- `next_role`
- `stance`ï¼ˆå¯é€‰ï¼Œå¦‚æœä½ æ„¿æ„æŠŠâ€œå§¿æ€â€ä¹Ÿç»“æ„åŒ–ï¼‰
- `role_choice_reason`ï¼ˆä»… debugï¼‰

#### 4.4.3 RolePicker çš„ Prompt å½¢æ€ï¼ˆå»ºè®®ï¼‰

RolePicker çš„æ ¸å¿ƒæ˜¯â€œåœ¨æ³¡æ³¡å›ºå®šè§’è‰²é›†åˆé‡Œï¼Œé€‰æœ€é€‚åˆæ‰¿è½½è¯¥æ‹ç‚¹çš„é•œå¤´è¯­è¨€çš„äººâ€ã€‚

è¾“å…¥ï¼ˆç¤ºæ„ï¼‰ï¼š
- `next_beat` + `user_must_do` + `flow_mode`
- `available_roles`
- `role_capabilities`ï¼ˆpersona/allowed_actions/allowed_stancesï¼‰
- `recent_role_memory`ï¼ˆæœ€è¿‘è°è¯´äº†ä»€ä¹ˆï¼‰

è¾“å‡ºï¼ˆç¤ºæ„ï¼‰ï¼š
```json
{
  "next_role": "host|economist|...",
  "stance": "Explain|Socratic|Challenge|Summarize|Encourage",
  "notes": "ä¸ºä»€ä¹ˆè¿™è½®ç”±å®ƒæ¥è®²ï¼ˆç»™ debugï¼‰"
}
```

### 4.5 è¿˜èƒ½æ›´å¥½å—ï¼šæŠŠâ€œå¯¼æ¼”â€æ‹†æˆå¯ç»„åˆçš„ 4 ä¸ªå­æ™ºèƒ½ï¼ˆæ•ˆæœä¼˜å…ˆæ¶æ„ï¼‰

å¦‚æœä½ æ›´åœ¨ä¹æ•ˆæœä¸å¯è¿­ä»£æ€§ï¼Œè€Œä¸æ˜¯å®ç°æœ€ç®€ï¼Œæ¨èæŠŠå¯¼æ¼”æ‹†æˆ 4 ä¸ªäº’ç›¸çº¦æŸçš„å°ç»„ä»¶ï¼ˆéƒ½å¯ä»¥æ˜¯ LLMï¼Œä¹Ÿå¯ä»¥é€æ­¥æ›¿æ¢æˆè§„åˆ™/æ¨¡å‹ï¼‰ï¼š

1) **StateSummarizer**ï¼šæŠŠæœ€è¿‘ N è½®å¯¹è¯å‹ç¼©æˆâ€œå¯¼æ¼”é¢æ¿â€ï¼ˆé¿å…ç›´æ¥å–‚å…¨æ–‡ï¼‰
2) **MindStateRouter**ï¼šè¾“å‡º MindState åˆ†å¸ƒ + FlowMode + Intent
3) **BeatPlanner/Picker**ï¼šå€™é€‰ç”Ÿæˆ + é€‰æ‹©ï¼ˆå¯åŒé˜¶æ®µï¼‰
4) **RolePicker + PromptCompiler**ï¼šé€‰è§’åæŠŠ plan ç¼–è¯‘æˆâ€œæ¼”å‘˜ä»»åŠ¡ä¹¦â€

å¥½å¤„ï¼š
- ä½ å¯ä»¥ç‹¬ç«‹è°ƒä¼˜æ¯ä¸ªå­æ¨¡å—ï¼ˆå°¤å…¶æ˜¯ Router ä¸ Pickerï¼‰
- ä½ å¯ä»¥æ›´å®¹æ˜“åšç¦»çº¿è¯„æµ‹ï¼ˆæ¯”å¦‚å›ºå®šè¾“å…¥é¢æ¿ï¼Œçœ‹é€‰æ‹©æ˜¯å¦æ›´åƒäººç±»å¯¼æ¼”ï¼‰
- ä½ å¯ä»¥æ›´è½»æ¾åœ°åŠ å…¥æ–°æ‹ç‚¹/æ–°è§’è‰²è€Œä¸æŠŠç³»ç»Ÿ prompt æ’‘çˆ†

#### 4.5.1 è¿›ä¸€æ­¥è¿½æ±‚æ•ˆæœï¼šä¸€æ‹å‰ç»ï¼ˆLookahead Rolloutï¼‰

åœ¨â€œæ•ˆæœä¼˜å…ˆã€æˆæœ¬ä¸æ•æ„Ÿâ€çš„å‰æä¸‹ï¼Œè¿˜å¯ä»¥å†åŠ ä¸€å±‚å°è§„æ¨¡â€œå‰ç»â€ï¼š

- å¯¹æ¯ä¸ªå€™é€‰ `DirectorPlan`ï¼Œç”¨ä¸€ä¸ª **UserSim**ï¼ˆLLMï¼‰é¢„æµ‹ç”¨æˆ·å¯èƒ½çš„ 1 è½®ååº”ï¼ˆæ–‡æœ¬å±‚é¢å³å¯ï¼‰
- å†ç”¨ **Judge** è¯„ä¼°å“ªæ¡è·¯å¾„æ›´å¯èƒ½é€¼å‡ºé«˜è´¨é‡ç”¨æˆ·è¾“å‡ºã€æ›´èƒ½æ¶ˆè¯¯è§£ã€æ›´ä¸æ‰“æ–­é¡ºæµ
- é€‰å‡ºæœ€ä¼˜ plan æ‰§è¡Œ

è¿™ç›¸å½“äºæŠŠâ€œå¯¼æ¼”â€ä»ä¸€æ­¥å†³ç­–å‡çº§ä¸ºâ€œä¸€æ­¥æœç´¢â€ï¼Œé€šå¸¸èƒ½æ˜¾è‘—å‡å°‘â€œé€‰é”™é•œå¤´å¯¼è‡´çš„å°¬èŠ/è·‘åâ€ã€‚

------

## 5. æ¼”å‘˜å¼•æ“å®ç°ï¼šPrompt Constructionï¼ˆæç¤ºè¯æ„å»ºï¼‰

åœ¨æ–°çš„æ¶æ„ä¸‹ï¼Œæ¼”å‘˜å¼•æ“ä¸å†ç›´æ¥ç”Ÿæˆå°è¯æ–‡æœ¬ï¼Œè€Œæ˜¯è´Ÿè´£**æ„å»ºå‘ç»™ GPT Realtime çš„ System Instructions æˆ– Session Update**ã€‚

### 5.1 ç»™æ¼”å‘˜çš„è¾“å…¥æ„é€ 

- **DirectorPlan**ï¼šå½“å‰æ‹ç‚¹ç­–ç•¥ï¼ˆBeat Strategyï¼‰ã€ç›®æ ‡è§’è‰²ï¼ˆRoleï¼‰ã€å¿…é¡»å¼•å¯¼çš„è¾“å‡ºåŠ¨ä½œï¼ˆOutputActionï¼‰ã€‚
- **Concept Pack**ï¼šæ ¸å¿ƒæ¦‚å¿µéª¨æ¶ã€å½“å‰è¯¯è§£æ ‡ç­¾ã€è¾¹ç•Œç‚¹ã€‚
- **User Context**ï¼šç”¨æˆ·å½“å‰çš„å¿ƒç†çŠ¶æ€ï¼ˆUserMindStateï¼‰ã€å·²ç¡®è®¤çš„èƒŒæ™¯ä¿¡æ¯ã€‚

### 5.2 è¾“å‡ºï¼šRealtime Instructions

æ¼”å‘˜è¾“å‡ºçš„æ˜¯ä¸€æ®µç»“æ„åŒ–çš„ Promptï¼Œç”¨äºæŒ‡å¯¼ GPT Realtime å¦‚ä½•è¯´è¯ï¼š

- **Role Definition**ï¼šæ˜ç¡®å½“å‰è§’è‰²çš„è¯´è¯é£æ ¼ï¼ˆå¦‚â€œä¸¥è°¨çš„ç»æµå­¦å®¶â€æˆ–â€œé€šä¿—çš„å’–å•¡åº—è€æ¿â€ï¼‰ã€‚
- **Task Instruction**ï¼šæ˜ç¡®å½“å‰çš„ä»»åŠ¡ï¼ˆå¦‚â€œç”¨æ¯”å–»è§£é‡Šæœºä¼šæˆæœ¬â€ã€â€œåé—®ç”¨æˆ·æ˜¯å¦ç†è§£â€ï¼‰ã€‚
- **Constraints**ï¼šæ˜ç¡®çº¦æŸæ¡ä»¶ï¼ˆå¦‚â€œå›ç­”ä¸è¶…è¿‡ 2å¥â€ã€â€œä¸è¦ä½¿ç”¨ä¸“ä¸šæœ¯è¯­â€ï¼‰ã€‚

### 5.3 æç¤ºè¯éœ€ä¸éœ€è¦ LLM ç”Ÿæˆï¼Ÿ

ä»â€œæ•ˆæœä¼˜å…ˆâ€çš„è§’åº¦ï¼Œç­”æ¡ˆæ˜¯ï¼š**å¯ä»¥è®© LLM å‚ä¸ç”Ÿæˆï¼Œä½†å¿…é¡»ç”¨â€œæ¨¡æ¿/å¡ç‰‡â€æŠŠç»“æ„é’‰æ­»**ã€‚

è¿™é‡Œç»™ä¸‰æ¡è·¯çº¿ï¼ˆä»ç¨³åˆ°å¼ºï¼‰ï¼š

#### è·¯çº¿ Aï¼šçº¯æ¨¡æ¿ï¼ˆæœ€ç¨³ï¼Œæœ€å¯æ§ï¼‰

- ä¸ºæ¯ä¸ª `beat_id` æå‰å†™å¥½ä¸€å¼  Prompt Templateï¼ˆç±»ä¼¼â€œæ‹ç‚¹æŒ‡ä»¤å¡â€ï¼‰
- æ¨¡æ¿é‡Œåªç•™å°‘é‡ slotï¼š`core_relation/misconception_tags/last_user_message/user_must_do/...`
- DirectorPlan åªè´Ÿè´£é€‰ beat/roleï¼ŒActorEngine è´Ÿè´£æŠŠ slot å¡«è¿›å»

é€‚ç”¨ï¼šæƒ³å…ˆæŠŠâ€œå¯¼æ¼”å†³ç­–è´¨é‡â€æ‹‰èµ·æ¥ï¼Œé¿å… prompt æ¼‚ç§»ã€‚

#### è·¯çº¿ Bï¼šæ¨¡æ¿ + LLM æ”¹å†™ï¼ˆæ•ˆæœæ›´å¥½ï¼Œé£é™©å¯æ§ï¼Œæ¨èï¼‰

- å…ˆç”¨æ¨¡æ¿ç”Ÿæˆâ€œç¡¬éª¨æ¶ promptâ€ï¼ˆç›®æ ‡ã€è¾“å‡ºå½¢å¼ã€ç¦å¿Œã€æ—¶é•¿ï¼‰
- å†è®©ä¸€ä¸ª LLM åš **Rewrite**ï¼š
  - æŠŠè¡¨è¾¾å†™å¾—æ›´è‡ªç„¶ã€æ›´åƒè¯¥è§’è‰²ã€æ›´è´´åˆç”¨æˆ·ä¸Šä¸‹æ–‡
  - ä½†ä¸å…è®¸æ”¹åŠ¨ç¡¬çº¦æŸå­—æ®µï¼ˆæ¯”å¦‚ talk_burstã€user_must_doã€must_referenceï¼‰
- æœ€ååšä¸€æ¬¡ deterministic æ ¡éªŒï¼šå…³é”®çº¦æŸæ˜¯å¦è¿˜åœ¨ã€æ˜¯å¦å¼•å…¥äº†æ–°æ¦‚å¿µã€æ˜¯å¦æŠŠâ€œå¿…é¡»ç”¨æˆ·è¾“å‡ºâ€å†™æ²¡äº†

é€‚ç”¨ï¼šä½ æ˜ç¡®è¿½æ±‚â€œåƒäººä¸€æ ·è¯´è¯â€ï¼ŒåŒæ—¶è¦å¯æ§ã€‚

#### è·¯çº¿ Cï¼šå…¨ LLM PromptCompilerï¼ˆæ•ˆæœä¸Šé™æœ€é«˜ï¼Œä½†è¦æ›´å¼ºæŠ¤æ ï¼‰

- LLM ç›´æ¥æŠŠ `DirectorPlan + BeatCard + ConceptPack` ç¼–è¯‘æˆ Realtime instructions
- å¿…é¡»é…å¥—ï¼š
  - JSON schema ç»“æ„åŒ–è¾“å‡ºï¼ˆåˆ† RoleDefinition/Task/Constraints/ToolCallsï¼‰
  - Guardrails æ ¡éªŒ + è‡ªåŠ¨ä¿®å¤ï¼ˆä¸åˆè§„å°±è®©å®ƒé‡å†™ï¼‰

é€‚ç”¨ï¼šä½ æ„¿æ„ä¸ºæ•ˆæœæŠ•å…¥æ›´å¤šå·¥ç¨‹æŠ¤æ ä¸è¯„æµ‹ä½“ç³»ã€‚

------

## 6. æµ‹è¯„ä¸é¢˜ç›®æ³¨å…¥ï¼šè‡ªé€‚åº”æµ‹è¯„ + æ‹ç‚¹å†…â€œå¾®æµ‹è¯„â€

### 6.1 é¢˜å‹æ¨¡æ¿åº“ï¼ˆç»“æ„åŒ–ç”Ÿæˆï¼‰

- Misconception Splitterï¼šæ¯ä¸ªé€‰é¡¹å¯¹åº”ä¸€ä¸ªè¯¯è§£æ ‡ç­¾
- Boundary Probeï¼šé€‚ç”¨/ä¸é€‚ç”¨æ¡ä»¶
- Transfer Swapï¼šæ¢åœºæ™¯åŒç»“æ„
- Feynman Rubricï¼šå¥å¼è„šæ‰‹æ¶ + è¯„åˆ†è¦ç‚¹ï¼ˆå…³ç³»è¯/æ¡ä»¶/ç»“æœï¼‰

### 6.2 è‡ªé€‚åº”ç­–ç•¥ï¼ˆV1 ç®€åŒ–ï¼‰

- åˆå§‹ï¼š1 é“æç®€å•é¢˜ï¼ˆå»ºç«‹ä¿¡å¿ƒï¼‰
- è‹¥æ­£ç¡®ä¸”è§£é‡Šå¼ºï¼šè·³åˆ°è¿ç§»é¢˜
- è‹¥æ­£ç¡®ä½†è§£é‡Šå¼±ï¼šå‡º Splitter/Boundary
- è‹¥é”™è¯¯ä½†æ¨ç†ä¸°å¯Œï¼šå‡ºæ›´æ¸…æ™°çš„ Check + LensShift
- è‹¥é”™è¯¯ä¸”å‘½ä¸­è¯¯è§£ï¼šTwistBeat + Splitter

> å…³é”®æ˜¯æŠŠâ€œè¯¯è§£æ ‡ç­¾â€å½“ä¸€ç­‰å…¬æ°‘ï¼Œé¢˜ç›®æ˜¯â€œæ‰“æ ‡ç­¾çš„æ¢é’ˆâ€ã€‚

------

## 7. åˆ†å‰é—®é¢˜æ ˆï¼ˆQuestionStackï¼‰ï¼šè®©ç”¨æˆ·è‡ªç”±ï¼Œä½†ä¸»çº¿ä¸æ•£

### 7.1 å…¥æ ˆç­–ç•¥

Branch åˆ¤å®šåå…¥æ ˆï¼Œè®°å½•ï¼š

- `question`
- `stage_at_ask`
- `urgency`ï¼ˆç”¨æˆ·æ˜¯å¦å¼ºçƒˆè¦æ±‚ç«‹åˆ»ç­”ï¼‰
- `link_to_objective`ï¼ˆä¸ä¸»ç›®æ ‡ç›¸å…³åº¦ï¼‰

### 7.2 å›æ”¶ç­–ç•¥ï¼ˆç‰‡å°¾å½©è›‹/Act IIIï¼‰

- æ¯æ¬¡åªå›æ”¶ 1 ä¸ª
- è‹¥ç›¸å…³åº¦é«˜ï¼šå½“ä½œ Deepen
- è‹¥ç›¸å…³åº¦ä½ï¼šç”Ÿæˆæ–°æ³¡æ³¡å…¥å£ï¼ˆEntryï¼‰å¹¶æ”¾é¦–é¡µæ¨è

------

## 8. å®æ—¶è¯­éŸ³æ’è¯ï¼ˆbarge-inï¼‰ï¼šç”µå½±æ„Ÿçš„å…³é”®å·¥ç¨‹ç‚¹

å¦‚æœä½ è¦â€œç”¨æˆ·å¯å®æ—¶æ’è¯â€ï¼Œå¿…é¡»åš **æµå¼ ASR + å¯ä¸­æ–­ TTS**ã€‚

### 8.1 æŠ€æœ¯æœºåˆ¶

- TTS æ’­æ”¾æ—¶å¹¶è¡Œå¼€ ASR ç›‘å¬
- ç›‘å¬åˆ°ç”¨æˆ·è¯­éŸ³èƒ½é‡ + è¯†åˆ«ç½®ä¿¡åº¦è¾¾é˜ˆå€¼ â†’ **ç«‹å³æš‚åœ TTS**
- å°†â€œè¢«æ‰“æ–­çš„æ¼”å‘˜å°è¯â€æ ‡è®°ä¸º `interrupted=true`ï¼Œå†™å…¥å¯¹è¯å†å²
- å¯¼æ¼”å¼•æ“æ¥æ”¶ `UserUtterance`ï¼Œå¹¶æŠŠ `interruptions++` ä½œä¸ºä¿¡å·è¾“å…¥ï¼ˆä»£è¡¨ç”¨æˆ·å‚ä¸æ„Ÿå¾ˆå¼ºæˆ–ä¸è€çƒ¦ï¼‰

### 8.2 è¢«æ‰“æ–­åçš„å¯¼æ¼”ç­–ç•¥

- è‹¥ç”¨æˆ· Clarifyï¼šç«‹åˆ» Check æˆ–çŸ­ Clarifyï¼Œå†å›åˆ°ä¸Šä¸€æ‹ç‚¹ç»§ç»­ï¼ˆå¿…è¦æ—¶ç”¨ Cooldown æ”¶æŸï¼‰
- è‹¥ç”¨æˆ· Branchï¼šå…¥æ ˆ + BranchTeaserï¼ˆç»™é€‰æ‹©ï¼‰
- è‹¥ç”¨æˆ· Off-topicï¼šè½»æ¥ä½åç”¨ Hook æ‹‰å›

------

## 9. æŒæ¡åº¦ä¸â€œæœ‰æ•ˆè¾“å‡ºè´¨é‡â€æ›´æ–°ï¼šå¯¼æ¼”çŠ¶æ€æœºçš„ç‡ƒæ–™

### 9.1 è¾“å‡ºè´¨é‡è¯„åˆ†ï¼ˆè½»é‡å¯å®ç°ï¼‰

æŠŠç”¨æˆ·è¾“å‡ºæ˜ å°„åˆ° 0â€“1ï¼š

- æ˜¯å¦åŒ…å«å…³ç³»è¯ï¼ˆå› æœ/æƒè¡¡ï¼‰
- æ˜¯å¦æåˆ°æ¡ä»¶/è¾¹ç•Œï¼ˆL4ï¼‰
- æ˜¯å¦èƒ½ä¸¾å‡ºè‡ªæ´½ä¾‹å­
- æ˜¯å¦èƒ½åŒºåˆ†ç›¸è¿‘æ¦‚å¿µï¼ˆè¯¯è§£æ¶ˆé™¤ï¼‰

è¿™å¯ä»¥å…ˆç”¨è§„åˆ™ + LLM åˆ¤åˆ†ç»“åˆï¼š

- è§„åˆ™ï¼šå…³é”®è¯/ç»“æ„ï¼ˆbecause/therefore/if-thenï¼‰
- LLMï¼šç»™å‡º rubric æ‰“åˆ†ä¸ä¸€å¥è§£é‡Šï¼ˆä¸å±•ç¤ºç»™ç”¨æˆ·ï¼‰

### 9.2 Mastery æ›´æ–°ï¼ˆV1ï¼‰

ä¸€ä¸ªå¯ç”¨çš„æ›´æ–°å¼ï¼š

- `mastery += Î± * (quiz_signal + output_quality_signal + transfer_signal) - Î² * misconception_pressure`
- `misconception_pressure` åœ¨ Twist/Boundary å‘½ä¸­çº æ­£åä¸‹é™

------

## 10. æ¦‚å¿µå›¾è°±ä¸è·¨é¢†åŸŸæ‰©å±•ï¼šç»æµå­¦åªæ˜¯ä¸€ä¸ª domain

ä¸ºäº†ä¸è¢«é¢†åŸŸé”æ­»ï¼Œå¯¼æ¼”çŠ¶æ€æœºå±‚é¢åªè®¤ï¼š

- `domain`
- `primary_concept_id`
- `core_relation`
- `misconceptions`
- `boundaries`
- `transfer_targets`

ç»æµå­¦/ç¼–ç¨‹/å†å²åªæ˜¯ Concept Pack çš„ä¸åŒå®ä¾‹ã€‚
æ³¡æ³¡â€œæ›´æœ‰è¶£â€çš„ç”Ÿæˆï¼Œæœ¬è´¨æ˜¯ `Scenario -> Concept` çš„æ˜ å°„ä¸æ”¹å†™ï¼ˆtitle/hookï¼‰ï¼Œä¸ä¼šå½±å“å¯¼æ¼”çš„æ§åˆ¶é€»è¾‘ã€‚

------

## 11. æ¨èçš„å®ç°å½¢æ€ï¼šåŒæ¨¡å‹ç¼–æ’ï¼ˆå¼ºçƒˆå»ºè®®ï¼‰

### 11.1 ä¸ºä»€ä¹ˆè¦åŒæ¨¡å‹

- å¯¼æ¼”æ¨¡å‹ï¼šå°è¾“å‡ºã€å¼ºç»“æ„ã€ç¨³å®šè·¯ç”±ï¼ˆä¾¿å®œä¸”å¯æ§ï¼‰
- æ¼”å‘˜æ¨¡å‹ï¼šè´Ÿè´£è¯­è¨€ã€æ•…äº‹ã€è§’è‰²é£æ ¼ï¼ˆæ›´â€œåƒå¤§ç‰‡â€ï¼‰

è¿™èƒ½æŠŠâ€œå¯æ§æ€§â€ä¸â€œè¡¨ç°åŠ›â€åˆ†å¼€ï¼Œé¿å…ä¸€ä¸ªæ¨¡å‹æ—¢è¦ç®¡ç»“æ„åˆè¦æ¼”æˆå¯¼è‡´æ¼‚ç§»ã€‚

------

## 12. ä¸€æ®µâ€œå¯è½åœ°â€çš„ä¼ªä»£ç çº§æ‰§è¡Œï¼ˆç®€åŒ–ç¤ºæ„ï¼‰

```text
while session.active:
  event = wait(user_input or tts_finished or timeout)

  update_signals(event)

  if state.stage == DIAGNOSE:
     q = assessment.next_question(state)
     ask(q)
     continue

  director_plan = director(state, last_turns, user_input)
  director_plan = apply_guardrails(director_plan, state)

  beat_card = BeatLibrary[director_plan.next_beat]
  actor_prompt = build_actor_prompt(state, director_plan, beat_card, concept_pack)

  actor_line = actor(actor_prompt)
  speak_or_show(actor_line)

  state = reducer(state, director_plan, actor_line, event)
```
